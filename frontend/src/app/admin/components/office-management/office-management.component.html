<div class="office-management">
  <div class="office-management__header">
    <h2>Gestión de Consultorios</h2>
    <button 
      class="btn btn-primary" 
      (click)="showCreateOfficeForm()"
      [disabled]="loading">
      <i class="material-icons">add</i>
      Nuevo Consultorio
    </button>
  </div>

  <!-- Error message -->
  <div *ngIf="error" class="alert alert-error">
    <i class="material-icons">error</i>
    {{ error }}
  </div>

  <!-- Loading state -->
  <div *ngIf="loading && offices.length === 0" class="loading">
    <i class="material-icons">refresh</i>
    Cargando consultorios...
  </div>

  <!-- Offices list -->
  <div *ngIf="!loading || offices.length > 0" class="office-list">
    <div *ngIf="offices.length === 0" class="empty-state">
      <i class="material-icons">business</i>
      <p>No hay consultorios registrados</p>
      <button class="btn btn-primary" (click)="showCreateOfficeForm()">
        Crear primer consultorio
      </button>
    </div>

    <div *ngFor="let office of offices" class="office-card">
      <div class="office-card__content">
        <div class="office-card__header">
          <h3>{{ office.code }} · {{ office.name || 'Sin nombre' }} (ID {{ office.id }})</h3>
          <span class="office-code">{{ office.code }}</span>
        </div>
        <div class="office-card__details">
          <p *ngIf="office.address" class="office-address">
            <i class="material-icons">location_on</i>
            {{ office.address }}
          </p>
        </div>
      </div>
      <div class="office-card__actions">
        <button 
          class="btn btn-secondary btn-sm"
          (click)="showEditOfficeForm(office)"
          [disabled]="loading">
          <i class="material-icons">edit</i>
          Editar
        </button>
        <button 
          class="btn btn-danger btn-sm"
          (click)="deleteOffice(office)"
          [disabled]="loading">
          <i class="material-icons">delete</i>
          Eliminar
        </button>
      </div>
    </div>
  </div>

  <!-- Create/Edit Form Modal -->
  <div *ngIf="showCreateForm" class="modal-overlay" (click)="cancelForm()">
    <div class="modal" (click)="$event.stopPropagation()">
      <div class="modal__header">
        <h3>{{ editingOffice ? 'Editar Consultorio' : 'Nuevo Consultorio' }}</h3>
        <button class="btn btn-icon" (click)="cancelForm()">
          <i class="material-icons">close</i>
        </button>
      </div>
      
      <form (ngSubmit)="onSubmit()" class="modal__form">
        <div class="form-group">
          <label for="code">Código *</label>
          <input
            type="text"
            id="code"
            [(ngModel)]="formData.code"
            name="code"
            required
            placeholder="Ej: OFC-001"
            class="form-control"
            [readOnly]="!!editingOffice">
          <small *ngIf="editingOffice" class="form-help">El código no se puede cambiar</small>
        </div>

        <div class="form-group">
          <label for="name">Nombre</label>
          <input
            type="text"
            id="name"
            [(ngModel)]="formData.name"
            name="name"
            placeholder="Ej: Consultorio Central"
            class="form-control">
        </div>

        <div class="form-group">
          <label for="address">Dirección</label>
          <textarea
            id="address"
            [(ngModel)]="formData.address"
            name="address"
            placeholder="Dirección del consultorio"
            rows="3"
            class="form-control">
          </textarea>
        </div>

        <div class="modal__actions">
          <button type="button" class="btn btn-secondary" (click)="cancelForm()">
            Cancelar
          </button>
          <button 
            type="submit" 
            class="btn btn-primary"
            [disabled]="loading || !formData.code.trim()">
            <i *ngIf="loading" class="material-icons">refresh</i>
            {{ editingOffice ? 'Actualizar' : 'Crear' }}
          </button>
        </div>
      </form>
    </div>
  </div>
</div>
