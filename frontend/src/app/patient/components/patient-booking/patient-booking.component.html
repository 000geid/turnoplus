<section class="patient-booking">
  <header class="patient-booking__header">
    <div>
      <h3>Reservar nuevo turno</h3>
      <p>Busc√° un profesional y eleg√≠ un horario disponible en su agenda.</p>
    </div>
  </header>

  <!-- Doctor Selection -->
  <app-doctor-autocomplete
    [doctors]="doctors()"
    [selectedDoctor]="selectedDoctor()"
    [loading]="isLoadingDoctors()"
    label="Seleccionar profesional"
    placeholder="Escrib√≠ el nombre o especialidad..."
    [showSpecialties]="true"
    [doctorAvailabilities]="getDoctorAvailabilityMap()"
    (doctorSelected)="onDoctorSelected($event)"
    (searchChanged)="onSearchChanged($event)"
  />

  <!-- Availability Summary -->
  @if (selectedDoctor(); as doctor) {
    <div class="availability-summary">
      <div class="selected-doctor-info">
        <h4>Disponibilidad de {{ doctor.full_name || doctor.email }}</h4>
        @if (doctor.specialty) {
          <p class="doctor-specialty">{{ doctor.specialty }}</p>
        }
      </div>
      
      @if (availableBlocks().length > 0) {
        <div class="summary-stats">
          <div class="stat-item">
            <span class="stat-number">{{ getQuickAvailabilitySummary().today }}</span>
            <span class="stat-label">hoy</span>
          </div>
          <div class="stat-item">
            <span class="stat-number">{{ getQuickAvailabilitySummary().week }}</span>
            <span class="stat-label">esta semana</span>
          </div>
          <div class="stat-item">
            <span class="stat-number">{{ getQuickAvailabilitySummary().month }}</span>
            <span class="stat-label">este mes</span>
          </div>
        </div>
      }
    </div>

    <div class="calendar-section">
      <app-shared-calendar
        mode="availability"
        [data]="availableBlocks()"
        [loading]="isLoadingBlocks()"
        (dayClick)="onCalendarDaySelected($event)"
        (monthChanged)="onCalendarMonthChanged($event)"
      />
    </div>
  } @else {
    <div class="no-doctor-selected">
      <div class="empty-icon">üë®‚Äç‚öïÔ∏è</div>
      <h4>Selecion√° un profesional</h4>
      <p>Eleg√≠ un profesional de la lista para ver su disponibilidad de turnos.</p>
      <p class="hint">Los profesionales con disponibilidad disponible aparecer√°n con indicadores.</p>
    </div>
  }
</section>

<!-- Day Availability Modal -->
@if (modalData()) {
  <app-day-availability-modal
    [data]="modalData()!"
    (modalClose)="onModalClose($event)"
  />
}