<section class="doctor-records">
  <header class="doctor-records__header">
    <div>
      <h3>Historias clínicas</h3>
      <p>Seleccioná un paciente para ver su historial médico o agregar un nuevo registro.</p>
    </div>
    <button type="button" class="btn btn-secondary" (click)="refresh.emit()" [disabled]="loadingPatients || loadingRecords">
      {{ (loadingPatients || loadingRecords) ? 'Actualizando…' : 'Actualizar' }}
    </button>
  </header>

  @if (message) {
    <p class="doctor-records__alert success">{{ message }}</p>
  }

  @if (error) {
    <p class="doctor-records__alert error">{{ error }}</p>
  }

  <app-doctor-patients-list
    [patients]="patients"
    [loading]="loadingPatients"
    [error]="error"
    (patientSelected)="onPatientSelected($event)"
  ></app-doctor-patients-list>

  @if (showModal() && selectedPatient() && doctorId) {
    <app-patient-medical-modal
      [patientId]="selectedPatient()!.id"
      [patientName]="selectedPatient()!.full_name || 'Paciente #' + selectedPatient()!.id"
      [doctorId]="doctorId"
      (modalClose)="onModalClose($event)"
    ></app-patient-medical-modal>
  }
</section>
