<section class="doctor-patients-list">
  <header class="doctor-patients-list__header">
    <div>
      <h3>Mis Pacientes</h3>
      <p>Seleccioná un paciente para ver su historial médico o agregar un nuevo registro.</p>
    </div>
  </header>

  <div class="doctor-patients-list__search">
    <input
      type="text"
      class="input"
      placeholder="Buscar por nombre, ID o número de historia clínica..."
      [value]="searchQuery()"
      (input)="onSearchChange($event.target.value)"
    />
  </div>

  @if (error) {
    <p class="doctor-patients-list__error">{{ error }}</p>
  }

  @if (loading) {
    <p class="doctor-patients-list__placeholder">Cargando pacientes...</p>
  } @else if (!filteredPatients().length) {
    <p class="doctor-patients-list__placeholder">
      @if (searchQuery()) {
        No se encontraron pacientes que coincidan con tu búsqueda.
      } @else {
        Aún no tenés pacientes asignados. Los pacientes aparecerán acá una vez que tengan turnos programados.
      }
    </p>
  } @else {
    <div class="doctor-patients-list__grid">
      @for (patient of filteredPatients(); track trackByPatientId($index, patient)) {
        <div class="patient-card" (click)="onPatientClick(patient)">
          <div class="patient-card__header">
            <h4 class="patient-card__name">
              {{ patient.full_name || 'Paciente #' + patient.id }}
            </h4>
            <span class="patient-card__id">ID: {{ patient.id }}</span>
          </div>
          
          <div class="patient-card__details">
            @if (patient.medical_record_number) {
              <p class="patient-card__detail">
                <span class="patient-card__label">Historia clínica:</span>
                {{ patient.medical_record_number }}
              </p>
            }
            @if (patient.date_of_birth) {
              <p class="patient-card__detail">
                <span class="patient-card__label">Fecha de nacimiento:</span>
                {{ patient.date_of_birth | date: 'dd/MM/yyyy' }}
              </p>
            }
            @if (patient.emergency_contact) {
              <p class="patient-card__detail">
                <span class="patient-card__label">Contacto de emergencia:</span>
                {{ patient.emergency_contact }}
              </p>
            }
          </div>
          
          <div class="patient-card__action">
            <span class="patient-card__action-text">Ver historial y agregar registro</span>
            <span class="patient-card__arrow">→</span>
          </div>
        </div>
      }
    </div>
  }
</section>
