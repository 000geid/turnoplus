<div class="availability-calendar">
  <!-- Calendar Header -->
  <div class="calendar-header">
    <div class="calendar-nav">
      <button type="button" class="btn btn-secondary" (click)="previousMonth()">
        <span class="icon">‹</span>
      </button>
      <h3 class="calendar-title">{{ monthName() }}</h3>
      <button type="button" class="btn btn-secondary" (click)="nextMonth()">
        <span class="icon">›</span>
      </button>
    </div>
    <button type="button" class="btn btn-primary" (click)="goToToday()">
      Hoy
    </button>
  </div>

  <!-- Calendar Grid -->
  <div class="calendar-grid">
    <!-- Day Headers -->
    <div class="day-headers">
      <div class="day-header">Dom</div>
      <div class="day-header">Lun</div>
      <div class="day-header">Mar</div>
      <div class="day-header">Mié</div>
      <div class="day-header">Jue</div>
      <div class="day-header">Vie</div>
      <div class="day-header">Sáb</div>
    </div>

    <!-- Calendar Days -->
    <div class="calendar-days">
      @for (day of calendarDays(); track day.date.toISOString()) {
        <div 
          class="calendar-day"
          [class.current-month]="day.isCurrentMonth"
          [class.today]="day.isToday"
          [class.selected]="isDaySelected(day)"
          [class.has-availability]="day.availability.length > 0"
          (click)="selectDay(day)"
        >
          <div class="day-number">{{ day.date.getDate() }}</div>
          
          @if (day.availability.length > 0) {
            <div class="day-availability">
              <div class="availability-summary">
                {{ getDayAvailabilitySummary(day) }}
              </div>
              
              @if (day.availability.length === 1) {
                <div class="single-availability">
                  {{ day.availability[0].startAt | date: 'HH:mm' }} - 
                  {{ day.availability[0].endAt | date: 'HH:mm' }}
                </div>
              } @else if (day.availability.length > 1) {
                <div class="multiple-availability">
                  {{ day.availability.length }} horarios
                </div>
              }
            </div>
          }
        </div>
      }
    </div>
  </div>

  <!-- Selected Day Details -->
  @if (selectedDate(); as currentSelectedDate) {
    @if (groupedAvailability(); as grouped) {
      <div class="selected-day-details">
        <h4>Disponibilidad del {{ currentSelectedDate | date: 'EEEE d MMMM' }}</h4>
        
        @if (grouped && grouped[currentSelectedDate.toDateString()] && grouped[currentSelectedDate.toDateString()].length > 0) {
          <div class="day-availability-list">
            @for (avail of grouped[currentSelectedDate.toDateString()] || []; track avail.id) {
            <div class="availability-item" (click)="selectAvailability(avail)">
              <div class="availability-time">
                {{ avail.startAt | date: 'HH:mm' }} - {{ avail.endAt | date: 'HH:mm' }}
              </div>
              <div class="availability-blocks">
                {{ getAvailableBlocksForDay({ date: currentSelectedDate, isCurrentMonth: true, isToday: false, availability: [avail] }) }} / 
                {{ getTotalBlocksForDay({ date: currentSelectedDate, isCurrentMonth: true, isToday: false, availability: [avail] }) }} disponibles
              </div>
            </div>
          }
        </div>
      } @else {
        <p class="no-availability">No hay disponibilidad para este día</p>
      }
      </div>
    }
  } @else {
    <div class="calendar-instructions">
      <p>Hacé clic en un día para ver la disponibilidad detallada</p>
    </div>
  }
</div>
